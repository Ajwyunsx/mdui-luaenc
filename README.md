# Lua代码混淆加密工具

一个基于Web的Lua代码混淆加密工具，采用mdui1.0风格设计，支持多种混淆技术和Lua环境版本。

## 功能特点

### 核心混淆功能
✅ **控制流结构混淆** - 添加无用的条件分支，打乱代码执行流程
✅ **代码逻辑流程混淆** - 插入无用的循环和计算，增加代码复杂性
✅ **局部变量命名混淆** - 将局部变量名替换为随机生成的标识符
✅ **全局变量加密处理** - 对全局变量进行加密处理
✅ **字符串加密保护** - 使用XOR算法加密字符串常量
✅ **数字加密转换** - 将数字常量转换为复杂表达式
✅ **表结构加密处理** - 对表构造器进行包装处理
✅ **布尔值混淆变换** - 将true/false转换为等价表达式
✅ **空值混淆处理** - 对nil值进行混淆处理
✅ **跳转语句混淆优化** - 对goto语句进行包装处理
✅ **花指令植入机制** - 插入无用的函数和变量

### 支持的Lua环境
- 标准Lua 5.0至5.4版本
- GGLua环境
- AndLua开发环境
- LuaJIT即时编译环境

### 混淆强度等级
- **基础混淆**：局部变量重命名 + 字符串加密
- **标准混淆**：基础混淆 + 数字混淆 + 布尔值混淆
- **高级混淆**：标准混淆 + 控制流混淆 + 花指令植入
- **极致混淆**：所有功能全开，最大化代码保护

### AndLua特殊处理
AndLua系统通过源代码中的require和import语句实现库文件自动导入，在加密AndLua项目时，工具提供以下选项：
- 将所有引入语句（require和import）提取至加密范围外
- 手动将相关库文件打包至应用安装包中

## 使用方法

### CLI 快速开始（推荐，保证可执行性）
- 在项目根目录运行：`node obfuscate-cli.js input.lua output.lua`
- 默认开启 `safeMode`，启用：`stringEncrypt`、`booleanObfuscate`、`nilObfuscate`；关闭：`numberEncrypt`、`oneLine`
- 若需开启整数混淆，可编辑 `obfuscate-cli.js` 中 `options.numberEncrypt = true`

### 浏览器使用
1. 打开 `index.html`
2. 在左侧选择需要的混淆选项（建议只开启字符串/布尔/nil混淆）
3. 在源代码区域输入Lua代码
4. 点击"混淆加密"按钮
5. 在结果区域查看混淆后的代码
6. 可选择复制结果或下载为文件

### 安全模式说明（默认）
- 采用分段解析：字符串、长字符串、行/块注释、代码段分别处理，避免语法粘连
- 仅在代码段应用空格规整与布尔/nil混淆；保留注释与字符串原样
- 字符串加密使用 `string.char` 序列，不引入占位符
- 小数（如 `0.5`、`3.14`）不会被错误处理；整数可按需表达式化

## 技术实现

### 混淆算法
- **变量混淆**：使用随机生成的标识符替换原始变量名，确保不与Lua关键字冲突
- **字符串加密**：采用字符编码数组和立即执行函数，动态解密字符串内容
- **数字混淆**：将数字常量转换为复杂的数学表达式和函数调用
- **控制流混淆**：插入无用的条件分支和循环，打乱代码执行流程
- **布尔值混淆**：将true/false转换为等价的逻辑表达式
- **nil值混淆**：将nil转换为复杂的函数调用和表达式
- **花指令植入**：随机插入无害的死代码，增加代码复杂度
- **结构混淆**：对表构造器进行等价替换和封装

### 兼容性保证
- 保留Lua关键字和内置函数名不被混淆
- 确保混淆后的代码语法正确，能够被Lua解释器正确解析
- 针对不同Lua版本进行适配，确保兼容性
- AndLua特殊处理确保库文件导入不受影响

## 文件结构
```
mdui-lua-obfuscator/
├── index.html          # 主页面
├── styles.css          # 自定义样式
├── lua-obfuscator.js   # 混淆算法核心
├── app.js              # 应用程序主逻辑
└── README.md           # 项目说明文档
```

## 注意事项

- 浏览器（Web）默认更强：开启 `stringEncrypt`、`stringEncryptLong`、`numberEncrypt`、`booleanObfuscate`、`nilObfuscate`、`oneLine`，并启用 `aggressive` 加强布尔/nil 等价替换。
- CLI 默认安全：开启 `stringEncrypt`、`booleanObfuscate`、`nilObfuscate`；关闭 `numberEncrypt` 与 `oneLine`（可按需修改 `obfuscate-cli.js` 以开启）。
- 已修复常见语法粘连：`<=`、`>=`、`==`、`~=`、`<<`、`>>` 等运算符的空格规整，避免 `< =` 等错误。
- 行注释 `--` 保留换行，不会与后续代码合并；块注释与长字符串完整保留；字符串统一采用 `string.char` 编码。
- 若开启整数/长字符串混淆，请先在小样例验证（如 `simple-test.lua`、`decimal-test.lua`）。
- 混淆会增加代码体积与少量执行开销，建议按需选择强度；AndLua 项目注意 `require`/`import` 处理，可在浏览器模式中关闭复杂混淆。

## 技术栈
- HTML5
- CSS3 (mdui 1.0)
- JavaScript (ES6+)
- 无需后端支持，纯前端实现

## 许可证
本项目采用MIT许可证，详见LICENSE文件。