<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代码混淆加密工具</title>
    <link href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" rel="stylesheet">
    <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body class="mdui-theme-primary-blue mdui-theme-accent-blue">
    <div class="mdui-appbar">
        <div class="mdui-toolbar mdui-color-blue-700">
            <a href="javascript:;" class="mdui-typo-headline">
                <span style="font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.2em;">LuaObEnc</span>
                <span style="margin-left: 10px; font-size: 0.9em;">代码混淆加密工具</span>
            </a>
            <div class="mdui-toolbar-spacer"></div>
            <div class="toolbar-actions">
            <a href="https://github.com/Ajwyunsx/mdui-luaenc" class="mdui-btn mdui-btn-icon" target="_blank" rel="noopener" aria-label="GitHub" title="打开GitHub仓库">
                <!-- GitHub SVG icon -->
                <svg class="github-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 2C6.48 2 2 6.58 2 12.26c0 4.52 2.87 8.35 6.84 9.7.5.09.68-.22.68-.48 0-.23-.01-.99-.01-1.79-2.78.62-3.37-1.2-3.37-1.2-.45-1.17-1.11-1.48-1.11-1.48-.9-.63.07-.62.07-.62 1 .07 1.53 1.05 1.53 1.05.89 1.56 2.33 1.11 2.9.85.09-.66.35-1.11.64-1.37-2.22-.26-4.56-1.14-4.56-5.08 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.31.1-2.73 0 0 .84-.27 2.75 1.05.8-.23 1.65-.35 2.5-.35.85 0 1.7.12 2.5.35 1.91-1.32 2.75-1.05 2.75-1.05.55 1.42.2 2.47.1 2.73.64.72 1.03 1.63 1.03 2.75 0 3.95-2.34 4.82-4.57 5.08.36.31.68.93.68 1.87 0 1.35-.01 2.44-.01 2.77 0 .26.18.58.69.48A10.03 10.03 0 0 0 22 12.26C22 6.58 17.52 2 12 2z"/>
                </svg>
            </a>
            <button class="mdui-btn mdui-btn-icon theme-toggle" onclick="toggleTheme()" title="切换主题">
                <i class="mdui-icon material-icons">brightness_6</i>
            </button>
            <button id="helpButton" class="mdui-btn mdui-btn-icon" title="帮助">
                <i class="mdui-icon material-icons">help_outline</i>
            </button>
            </div>
        </div>
    </div>

    <div class="mdui-container">
        <!-- LuaObEnc 大字标题 -->
        <div class="mdui-card mdui-m-b-3" style="background: linear-gradient(135deg, #1976d2, #42a5f5); color: white; text-align: center; padding: 2rem;">
            <div style="font-family: 'Courier New', monospace; font-size: 3rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 0.5rem;">
                LuaObEnc
            </div>
            <div style="font-size: 1.2rem; opacity: 0.9;">
                专业的 Lua 代码混淆加密工具
            </div>
            <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;">
                <i class="mdui-icon material-icons" style="vertical-align: middle; margin-right: 4px;">link</i>
                项目地址：https://github.com/Ajwyunsx/mdui-luaenc
            </div>
        </div>
        
        <div class="mdui-card mdui-m-b-2">
            <div class="mdui-card-content">
                <div class="mdui-typo">
                    <p>
                        <i class="mdui-icon material-icons" style="vertical-align: middle; margin-right: 6px;">info</i>
                        本工具生成的混淆代码适配主流 Lua 环境（5.1–5.4、LuaJIT、AndLua、GGLua），无需选择版本。
                    </p>
                    <div class="mdui-m-t-2">
                        <div class="mdui-chip-group">
                            <div class="mdui-chip">
                                <span class="mdui-chip-title">选择语言:</span>
                            </div>
                            <label class="mdui-chip mdui-ripple">
                                <input type="radio" name="language" value="lua" checked>
                                <span class="mdui-chip-title">Lua</span>
                            </label>
                            <label class="mdui-chip mdui-ripple">
                                <input type="radio" name="language" value="javascript">
                                <span class="mdui-chip-title">JavaScript</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mdui-row">
            <div class="mdui-col-md-4">
                <div class="mdui-card">
                    <div class="mdui-card-header">
                        <div class="mdui-card-header-title">混淆选项</div>
                    </div>
                    <div class="mdui-card-content">
                        <ul class="mdui-list">
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="controlFlow" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    控制流结构混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="codeLogic" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    代码逻辑流程混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="localVar" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    局部变量命名混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="globalVar" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    全局变量加密处理
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="functionNameObfuscate" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    函数名混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="builtinAliasObfuscate" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    内置方法别名混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="obfuscateFunctionDefinitions">
                                    <i class="mdui-checkbox-icon"></i>
                                    函数定义重命名（需启用函数名混淆）
                                </label>
                            </li>
                            <li class="mdui-list-item">
                                <div class="mdui-textfield">
                                    <label class="mdui-textfield-label">函数白名单（逗号分隔）</label>
                                    <input class="mdui-textfield-input" type="text" id="functionWhitelist" placeholder="例：main,init,render">
                                </div>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="stringEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    字符串加密保护
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="byteEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    字节级XOR加密（默认启用）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="numberEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    数字加密转换
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                                    <label class="mdui-checkbox" style="margin-right:12px;">
                                        <input type="checkbox" id="numberBaseStrengthen">
                                        <i class="mdui-checkbox-icon"></i>
                                        整数进制加强（兼容）
                                    </label>
                                    <label style="display:flex;align-items:center;gap:8px;">
                                        <span>进制风格</span>
                                        <select id="numberBaseStyle" class="mdui-select" style="min-width:200px;">
                                            <option value="tonumber" selected>tonumber(字符串, base)（最大兼容，推荐）</option>
                                            <option value="hexliteral">十六进制字面量 0x..（Lua5.1/5.2 可能不支持）</option>
                                            <option value="mixed">混合（随机在两种之间）</option>
                                        </select>
                                    </label>
                                    <label style="display:flex;align-items:center;gap:8px;">
                                        <span>层数（tonumber嵌套）</span>
                                        <input type="number" id="numberBaseLayers" min="1" max="32" step="1" value="16" style="width:120px;">
                                    </label>
                                    <label style="display:flex;align-items:center;gap:8px;">
                                        <span>字符串化风格</span>
                                        <select id="numberStringifyStyle" class="mdui-select" style="min-width:200px;">
                                            <option value="mixed" selected>混合（随机在 ""..expr 与 tostring 之间）</option>
                                            <option value="plain">简单拼接（"" .. expr）</option>
                                            <option value="tostring">调用 tostring(expr)</option>
                                        </select>
                                    </label>
                                </div>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="tableEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    表结构加密处理
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="booleanObfuscate" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    布尔值混淆变换
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="nilObfuscate" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    空值混淆处理
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="gotoObfuscate" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    跳转语句混淆优化
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="junkCode">
                                    <i class="mdui-checkbox-icon"></i>
                                    花指令植入机制
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="codeSplitReorganize">
                                    <i class="mdui-checkbox-icon"></i>
                                    代码分割和重组
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="antiDebug">
                                    <i class="mdui-checkbox-icon"></i>
                                    反调试和反逆向工程技术
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="jsStringEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    JavaScript字符串加密
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="jsNumberEncrypt" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    JavaScript数字加密
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="jsControlFlow" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    JavaScript控制流混淆
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="jsDeadCode" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    JavaScript死代码注入
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="stringEncryptLong" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    长字符串加密（[[...]]转 string.char）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="aggressive" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    激进模式（更强布尔/nil等价替换）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="oneLine" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    单行压缩（极限混淆）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="webStandardWrapper">
                                    <i class="mdui-checkbox-icon"></i>
                                    网页标准包装（环境前导）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="loadIIFEWrapper">
                                    <i class="mdui-checkbox-icon"></i>
                                    load/IIFE 包裹（直接执行）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="tailStopGuard" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    尾部停止（防插入保护）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <div class="mdui-row">
                                    <div class="mdui-col-xs-12">
                                        <label class="mdui-textfield-label">尾部停止风格</label>
                                        <select id="tailStopGuardMode" class="mdui-select">
                                            <option value="hard" selected>硬停止（编译阻断）</option>
                                            <option value="soft">软停止（运行时提前返回）</option>
                                        </select>
                                    </div>
                                </div>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="stringEscapeDecimal" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    索引字符串十进制转义（\\ddd）
                                </label>
                            </li>



                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="wrapSourceAsEncoded">
                                    <i class="mdui-checkbox-icon"></i>
                                    整段编码封装执行（先编码后运行）（注意：如果实在不行那就用这个这是通用）
                                </label>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <div class="mdui-row">
                                    <div class="mdui-col-xs-12">
                                        <label class="mdui-textfield-label">整段编码风格</label>
                                        <select id="sourceEncodingStyle" class="mdui-select">
                                            <option value="decimal">十进制转义（\\ddd）</option>
                                            <option value="charlist">string.char 列表</option>
                                        </select>
                                    </div>
                                </div>
                            </li>
                            <li class="mdui-list-item mdui-ripple">
                                <label class="mdui-checkbox">
                                    <input type="checkbox" id="sourcePreferLoadstring" checked>
                                    <i class="mdui-checkbox-icon"></i>
                                    loadstring 优先（无则回退 load）
                                </label>
                            </li>
                        </ul>
                    </div>
                </div>

                
            </div>

            <div class="mdui-col-md-8">
                <div class="mdui-card">
                    <div class="mdui-card-header">
                        <div class="mdui-card-header-title">源代码</div>
                    </div>
                    <div class="mdui-card-content">
                        <div class="mdui-textfield">
                            <textarea class="mdui-textfield-input code-area" id="sourceCode" rows="20" placeholder="在此输入Lua或JavaScript源代码...&#10;&#10;支持语法：&#10;• Lua 5.1/5.2/5.3/5.4&#10;• JavaScript ES5/ES6+&#10;• AndLua特殊语法&#10;&#10;提示：使用Ctrl+A全选，Ctrl+C复制，Ctrl+V粘贴"></textarea>
                        </div>
                        <div class="mdui-row mdui-m-t-2">
                            <div class="mdui-col-xs-12">
                                <div class="button-group">
                                    <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-blue-700 mdui-btn-dense" onclick="obfuscateCode()">
                                        <i class="mdui-icon material-icons">security</i> 
                                        <span class="btn-text">混淆加密</span>
                                    </button>
                                    <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-grey-600 mdui-btn-dense" onclick="clearSource()">
                                        <i class="mdui-icon material-icons">clear</i> 
                                        <span class="btn-text">清空</span>
                                    </button>
                                    <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-green-600 mdui-btn-dense" onclick="loadExample()">
                                        <i class="mdui-icon material-icons">code</i> 
                                        <span class="btn-text">加载示例</span>
                                    </button>
                                    <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-orange-600 mdui-btn-dense" onclick="copyResult()">
                                        <i class="mdui-icon material-icons">content_copy</i> 
                                        <span class="btn-text">复制结果</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mdui-card mdui-m-t-2">
                    <div class="mdui-card-header">
                        <div class="mdui-card-header-title">混淆结果</div>
                    </div>
                    <div class="mdui-card-content">
                        <div class="mdui-textfield">
                            <textarea class="mdui-textfield-input code-area" id="obfuscatedCode" rows="20" placeholder="混淆后的代码将显示在这里...&#10;&#10;功能特性：&#10;• 字符串加密保护&#10;• 控制流混淆&#10;• 函数名混淆&#10;• 垃圾代码注入&#10;• 反调试保护&#10;&#10;提示：点击下载按钮保存结果文件" readonly></textarea>
                        </div>
                        <div class="mdui-row mdui-m-t-2">
                            <div class="mdui-col-xs-12">
                                <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-green-600" onclick="downloadResult()">
                                    <i class="mdui-icon material-icons">file_download</i> 下载结果
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mdui-container footer-card">
        <div class="mdui-card">
            <div class="mdui-card-content">
                <div class="mdui-typo">
                    <p>界面已优化：置顶工具栏、改进留白与字体、支持浅/深色切换。</p>
                </div>
            </div>
        </div>
    </div>

    <div class="mdui-dialog" id="helpDialog">
        <div class="mdui-dialog-title">使用帮助</div>
        <div class="mdui-dialog-content">
            <h4>工具说明</h4>
            <p>这是一个Lua代码混淆加密工具，支持多种混淆技术和Lua环境。</p>
            
            <h4>使用方法</h4>
            <ol>
                <li>在左侧选择需要的混淆选项</li>
                <li>选择目标Lua环境版本</li>
                <li>在源代码区域输入Lua代码</li>
                <li>点击"混淆加密"按钮</li>
                <li>在结果区域查看混淆后的代码</li>
            </ol>
            
            <h4>尾部停止（防插入保护）</h4>
            <p>用于阻断在文件末尾添加的恶意或无意插入代码：</p>
            <ul>
                <li>硬停止：在末尾添加顶层 <code>return</code>，使后续插入的代码在编译阶段直接报错。</li>
                <li>软停止：在末尾添加 <code>do return end</code>，编译通过，但运行时提前返回，不执行插入代码。</li>
                <li>当启用 <code>load/IIFE 包裹</code> 或 <code>整段编码封装</code> 时，已存在顶层 <code>return (function(...) ... end)()</code>，无需再追加尾部停止，避免重复导致语法冲突。</li>
            </ul>

            <h4>快速验证</h4>
            <ol>
                <li>生成混淆代码后，在文件末尾追加一行 <code>print("injected")</code>。</li>
                <li>硬停止：使用 <code>luac53</code> 编译应报错；软停止：可编译，但运行时不会打印。</li>
                <li>启用包裹：末尾的顶层 <code>return</code> 已提供硬停止效果。</li>
            </ol>

            <h4>AndLua特殊处理</h4>
            <p>AndLua系统通过源代码中的require和import语句实现库文件自动导入，在加密AndLua项目时，需要将所有引入语句提取至加密范围外，或手动将相关库文件打包至应用安装包中。</p>
        </div>
        <div class="mdui-dialog-actions">
            <button class="mdui-btn mdui-ripple" mdui-dialog-close>关闭</button>
        </div>
    </div>

    <script src="lua-obfuscator.js"></script>
    <script src="js-obfuscator.js"></script>
    <script src="app.js"></script>
    <script>
      function toggleTheme() {
        const body = document.body;
        if (body.classList.contains('mdui-theme-layout-dark')) {
          body.classList.remove('mdui-theme-layout-dark');
          mdui.snackbar({message: '已切换到浅色主题', position: 'top'});
        } else {
          body.classList.add('mdui-theme-layout-dark');
          mdui.snackbar({message: '已切换到深色主题', position: 'top'});
        }
      }
    </script>
</body>

</html>
